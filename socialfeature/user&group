from __future__ import annotations
from dataclasses import dataclass, field
from typing import List, Optional


@dataclass
class User:
    user_id: str
    name: str

    total_wins: int = 0
    total_losses: int = 0
    pnl: float = 0.0
    greatest_win: float = 0.0
    greatest_loss: float = 0.0
    win_streak: int = 0
    number_of_bets: int = 0

    def __str__(self):
        return (
            f"User({self.name} | wins={self.total_wins}, losses={self.total_losses}, "
            f"PnL={self.pnl}, greatest_win={self.greatest_win}, "
            f"greatest_loss={self.greatest_loss}, win_streak={self.win_streak}, "
            f"bets={self.number_of_bets})"
        )


@dataclass
class UserGroup:
    users: List[User] = field(default_factory=list)

    jester: Optional[User] = None
    king: Optional[User] = None
    fool: Optional[User] = None
    addict: Optional[User] = None
    coward: Optional[User] = None
    capitalist: Optional[User] = None

    def add_user(self, user: User) -> None:
        self.users.append(user)
        self.recompute_titles()

    def remove_user(self, user: User) -> bool:
        try:
            self.users.remove(user)
        except ValueError:
            return False
        self.recompute_titles()
        return True

    def recompute_titles(self) -> None:
        if not self.users:
            self.jester = self.king = self.fool = None
            self.addict = self.coward = self.capitalist = None
            return

        jester = king = fool = addict = coward = capitalist = self.users[0]

        for u in self.users[1:]:
            if u.total_losses > jester.total_losses:
                jester = u
            if u.total_wins > king.total_wins:
                king = u
            if u.greatest_loss < fool.greatest_loss:
                fool = u
            if u.number_of_bets > addict.number_of_bets:
                addict = u
            if u.number_of_bets < coward.number_of_bets:
                coward = u
            if u.pnl > capitalist.pnl:
                capitalist = u

        self.jester = jester
        self.king = king
        self.fool = fool
        self.addict = addict
        self.coward = coward
        self.capitalist = capitalist

    def __str__(self):
        return (
            "UserGroup:\n"
            f"  King (most wins): {self.king.name if self.king else 'None'}\n"
            f"  Jester (most losses): {self.jester.name if self.jester else 'None'}\n"
            f"  Fool (biggest loss): {self.fool.name if self.fool else 'None'}\n"
            f"  Addict (most bets): {self.addict.name if self.addict else 'None'}\n"
            f"  Coward (least bets): {self.coward.name if self.coward else 'None'}\n"
            f"  Capitalist (top PnL): {self.capitalist.name if self.capitalist else 'None'}\n"
        )

if __name__ == "__main__":
    u1 = User("1", "Alice", total_wins=5, total_losses=3, pnl=120, greatest_win=70, greatest_loss=-30, win_streak=2, number_of_bets=8)
    u2 = User("2", "Bob", total_wins=2, total_losses=6, pnl=-50, greatest_win=40, greatest_loss=-60, win_streak=1, number_of_bets=12)
    u3 = User("3", "Charlie", total_wins=4, total_losses=1, pnl=200, greatest_win=100, greatest_loss=-10, win_streak=4, number_of_bets=5)

    group = UserGroup()
    group.add_user(u1)
    group.add_user(u2)
    group.add_user(u3)

    # Print each user
    print(u1)
    print(u2)
    print(u3)

    # Print group rankings
    print(group)
